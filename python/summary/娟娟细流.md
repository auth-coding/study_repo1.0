# python 

## 学习资料

### python 进阶
- [python cookbook](https://python3-cookbook.readthedocs.io/zh_CN/latest/)

### python异步任务
- [celery]异步任务框架(https://www.pyfdtic.com/2018/03/16/python-celery-%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97/)

## 学习感悟和笔记

1. python使用smtp协议发送邮件的一些坑
    * 不同的邮件服务器会有不同的规定，qq邮箱会要求启用该邮箱的smtp服务，并通过授权码作为密码登录(该授权码一般用于登录第三方客户端, 比如简信,程序也可以看做第三方客户端)。
    * smtp默认端口为25，启用ssl时端口可用465，587。
        ```python
        USE_SSL = True
        PORT = 465
        # tsl协议
        USE_TSL = True
        PORT = 587
        ```
    * qq邮箱发送到其他服务器的邮件需要使用端口， 且启用TLS。
    * 发送附件可使用MIMEMultipart，
    邮件正文和附件都可以看做邮件内容的一部分，先创建每一部分，再分别attach到邮件上。
    * 使用163邮箱会有个很坑的地方, msg["To"]和sendmail的函数参数reciver必须一样，否则会报554错误，判断为垃圾邮件，从而发送失败。如此设定，群发时怎么一一对应是个问题(手动循环群发除外)

2. python中非常有趣或者有用的模块
    * wxpy，通过构建一个类似web微信的机器人对象，可以实现对微信的各种操作，比如和好友聊天，加入群聊等。
* requests，最好用的http(s)请求库, 支持各种方法，以及构造复杂请求参数，甚至可以完美作为程序中的postman
    * pandas, pandas支持对各种数据文件的(csv, xlsx等等)读取,以及数据对象的各种操作分析， 比起csv,xlrd等模块更好用。
* wordcloud，可以根据文本或者词频生成词云,支持各种样式和设置和背景。
    * jieba， 一个好用的nlp库， 可用于分词，准确率极高。
    * xpinyin 可以将汉字转为拼音, 默认使用"-"分隔, 处理多音字效果不好
    * MyQR 可以简单的生成个性化二维码
    * faker和lipsum等库，可生成随机伪造数据。
    
3. python中print和在交互式环境下变量名的区别  
    print是python中的打印函数， 会对转义字符做处理，比如\b就会让光标回退一格再继续打印后面的值，再交互式环境中，直接使用变量名输出结果，输出的是这个变量存储在计算机中的值而不是打印出来的结果， 而\b的ASCII码值应该就是\x08,  

    ![print和变量值得差异](../img/diff.jpg)
    
4. python下载文件
    ```python
   from urllib.request import urlretrieve
   # python2 from urllib import urlretrieve
   download_url = "https://www.baidu.com/img/bd_logo1.png"
   file_path = "../img/baidu.png"
   urlretrieve(download_url, file_path)

   ```
   
5. python网址编码
    ```python
   from urllib.parse import quote
   keyword = "周杰伦"
   params = quote(keyword.encode("utf-8"))
   search_url = "https://y.qq.com/portal/search.html#page=1&searchid=1&remoteplace=txt.yqq.top&t=song&w={}".format(params)
   # requests请求会默认对参数进行urlencode, 所以不要传递urlencode过的参数给requests请求

   ```

6. python函数式编程命令陷阱  
    python支持函数式编程且万事万物皆为对象，即函数也是一个对象
    ，函数也可以作为参数传递，也可以作为变量赋值。  
    所以平时简单变量命令之时千万注意不要使用内置函数的名字作为
    变量名，如果这样操作，极有可能使内置函数不再有指针指向，
    从而无法应用，甚至被python作为垃圾回收。

7. python程序的启动和导入

* python导入的理解
    * python的导入会将要导入的python文`执行一遍`，而除非是程序入口，一般都是禁止直接将可执行代码放入顶层命名空间，而是存放一系列功能函数和抽象好的各种类。
    * import 语句，其实也是一句可执行的代码，他会到需要导入的文件中，将所有代码执行一遍，从而拥有导入文件的全局变量，当在导入文件遇到import语句时，会继续执行上述步骤，知道完成所有导入，回到导入语句，继续执行下一句，就如递归一般。
* 循环导入
    * 这样的设定，当然会出现问题，比如下面的代码:
    ```python
    # ./a.py
    from .b import *
    print('this is in a.py')

    # ./b.py
    from .a import *
    print('this is in b.py')
    ```
    * 在a.py导入b.py的内容;
    * 进入b.py, 执行`from .a import *`
    * 再次进入a.py, 遇到`from .b import *`
    * python导入中的一个原则，同样的内容不会导入第二次，因此没有执行`from .b import *`
    * 在a.py执行`print('this is in a.py')
    * 回到b.py,也就相当于执行完`from .a import *`这行代码
    * 执行完`print('this is in b.py')`,
    回到a.by, 相当于之前的所有步骤只是执行完了`from .b import *`这一行代码,
    * 再次执行`print('this is in a.py')`
    ,程序结束。

> 以上的例子是最简单的循环导入，由此可见python对同样的导入只导入一次，对循环导入做了一定程度的限制或者缓解，但是`print('this is in a.py')`仍然执行了两次，而且执行步骤异常繁琐复杂， 十分不利于执行程序的理解和执行。当然问题就有对应的解决办法，更何况在软件行业，没有什么是不能通过一个中间层去解决的，当然这是另外一个话题了， 今天就先不写了。
* 执行与程序入口

## 前后端的理解

[你不得不了解的前后端分离的原理](https://juejin.im/post/5b71302351882560ea4afbb8)

### headers 
响应头和请求头， 包含了http请求的大部分设置

* content-type 是指定前端解析返回内容的格式，默认为text/html
    * text/html html格式的文本，
    * text/plain 纯文本
    * application/json json格式数据

* location 重定向的url
    重定向的原理是在响应头里添加location，浏览器解析出了location，会马上再次请求location对应的地址，最后返回最后请求的结果，而达到了重定向的效果。

###  response-响应主体
web响应的本质都是字符串(响应主体)，只不过通过content-type，解析成了不同的结果，
* 根据json在javascript里的定义和基于上一句的理解，其实json也是一个特定格式的字符串，
* 字符串的优点在于结构简单，便于存储和传输，但是缺点是难以组织和体现数据之间的关系；
* 因此web应用中数据传输一般使用json字符串，但是使用时会使用json对应的数据结构；
* 数据结构转换成json对象(字符串)时， 称为序列化，json转回数据结构的过程称为反序列化；
* 同时需要注意的是，在python中，json字符串中的字符串都是使用单引号套用双引号的格式，参考示例1.
* json不是唯一的序列化的格式。
```python
'{"b": "Hello", "c": null, "a": true}'
```
### 接口与服务
* api的难点在于设计而非实现
    * 设计及的难点主要是接口的规范，接口认证，权限控制，频率控制。
* restful api是一种接口设计风格，接口的操作对象是服务器上的一种资源，而get，delete等具体的method则对应着具体的对资源的操作，restful还定义了一系列请求和响应的规范。
    * 优雅的restful api实现可以参考gitlab和github
    * [restful基础概念](http://www.ruanyifeng.com/blog/2018/10/restful-api-best-practices.html)

* 接口的最大优势在于其解耦和复用性

    * 解耦，后端可以单独部署，前后端独立开发，而接口是联系前后端的唯一的枢纽，因此规范的接口的直观重要
    * 复用性，一套api适用多个终端，多个项目，
    因为一套接口是独立部署，是一个独立的项目，
    因此前后端的接口请求实质是网络请求，而且http(s)协议的请求，任何终端的任意应用都可以通过网络请求接口，因此也延伸出了接口的认证等一系列问题。
    * 通过接口的解耦， 后端已经不用依赖于前端，可以单独开发和部署一个没有界面的后端项目，通过暴露接口和对接口进行认证等方式，让每一个有权限的人都能使用对应接口，而接口的参数调用方式——传入请求参数——返回请求结果，越发像一个函数的请求方式，因此现在的接口不仅仅用于给前端返回数据，而可以用于提供给用户，提供各种功能，解决各种问题，其实也就是服务。
        * 越来越多的公司喜欢开发这种没有前端页面的，单纯部署接口的项目，比如百度的语音识别接口，地图接口，都可以用于给用户提供各种服务，当然为了服务的易用性，百度也会提供易用简明的前端界面。
        * 可以用来解决使用者某种需求的接口都可以说是一种服务，与传统接口不同的是，这些接口更加通用，因为不仅仅提供给某个项目使用，甚至不仅仅是公司内部，所有对接口功能有此需求的用户都是他们的意向用户，而通过开发的接口认证，接口就能为每一个得到认证的请求提供服务。
        * 微服务的诞生在我的理解则是敏捷开发，快速部署，前后端分离，开放开源等一系列趋势综合而诞生的更大的趋势。
        * 微服务的项目都可以很小，甚至于只有几个接口，但是微服务的理念正是解耦和复用性，把一个综合的大型的项目逐渐拆解，把其中通用的部分，或者功能的部分独立出来，开放出来，提供给更多的项目使用，如此把一个大型的项目拆分成了几个更内聚的小项目，实现了功能的解耦，也实现了服务的复用性。
        * 当然微服务里面也会存在各种问题，比如虽然独立成了更多的项目，看似完成了解耦，但是提供公共服务的项目成为了一个中心枢纽似的存在，成为更多项目的依赖，一旦这么一个公共服务挂掉，将会对所有依赖于公共服务的项目造成影响，当然诸如此类的问题都有解决的问题，而这正是学习的意义。

## 异步和同步

说到同步和异步，就不得不说道阻塞和非阻塞，这两组概念分开来说，任意一组
都比较清晰明了，若是混在一起，则概念复杂不明，网上的资料也是众说纷纭，
反而不好区分了。

* 个人理解，先说同步和异步的概念，是指指令或者代码的执行顺序，同步
是线性的执行顺序，是一步步从上而下的执行顺序，也可说是单线程的顺序结构，
如果多线程的程序，那么执行顺序就不再是线性的了。

* 其他理解和感悟
  
   todo
